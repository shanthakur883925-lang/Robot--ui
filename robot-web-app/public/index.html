<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Control Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="xterm.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- SCREEN 1: SELECTION (Preserved functionality) -->
    <div id="selection-screen" class="active">
        <h1>Select a Robot</h1>
        <div class="cards-container">
            <div class="robot-card" onclick="selectRobot('ZippyX')">
                <img src="assets/zippyx.png" alt="ZippyX">
                <h2>ZippyX</h2>
                <button class="about-btn" onclick="event.stopPropagation(); showAbout('ZippyX')">About ZippyX</button>
            </div>
            <div class="robot-card" onclick="selectRobot('Zippy40')">
                <img src="assets/zippy40.png" alt="Zippy40">
                <h2>Zippy40</h2>
                <button class="about-btn" onclick="event.stopPropagation(); showAbout('Zippy40')">About Zippy40</button>
            </div>
        </div>
    </div>

    <!-- SCREEN 2: DASHBOARD (New Layout) -->
    <div id="command-screen">

        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div onclick="goHome()" class="nav-item">
                <i class="fas fa-home"></i>
            </div>
            <div class="nav-item active">
                <i class="fas fa-chart-bar"></i>
            </div>
            <div class="nav-item">
                <i class="fas fa-layer-group"></i>
            </div>
            <div class="nav-item">
                <i class="fas fa-search"></i>
            </div>
            <div class="nav-item" style="margin-top: auto; margin-bottom: 2rem;">
                <i class="fas fa-cog"></i>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <div class="main-content">

            <!-- TOP BAR -->
            <div class="top-bar">
                <div class="app-title">
                    <img id="header-img" src="" alt="Icon" width="30" height="30">
                    <span id="header-title">Robot Name</span> Control Panel
                </div>
                <!-- RELOCATED STOP BUTTON -->
                <button onclick="stopCommand()" style="
                    background: #dc2626; 
                    color: white; 
                    border: 2px solid #ef4444; 
                    padding: 8px 30px; 
                    border-radius: 6px; 
                    font-weight: 800; 
                    letter-spacing: 1px;
                    cursor: pointer;
                    margin-right: 2rem;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    box-shadow: 0 4px 6px rgba(220, 38, 38, 0.2);
                ">
                    <i class="fas fa-stop-circle"></i> STOP
                </button>
            </div>

            <!-- OVERVIEW CARD -->
            <div class="overview-card">
                <div style="flex:1">
                    <h3 style="margin:0 0 5px 0; font-size: 1rem; color: #94a3b8;">Robot Overview</h3>
                    <div class="input-group">
                        <span style="font-size: 1.2rem; font-weight:600;">Robot ID :</span>
                        <input type="text" id="robot-number" value="" placeholder="Enter ID">
                    </div>
                </div>
                <!-- Mini Stats just for visuals -->
                <div style="text-align: right; color: #94a3b8; font-size: 0.8rem;">
                    <div>Battery Level</div>
                    <div id="overview-battery" style="font-size: 1.5rem; color: #64748b; font-weight:700;">0%</div>
                </div>
            </div>

            <!-- MODE CARDS -->
            <div class="mode-section">
                <!-- Teleop -->
                <div class="mode-card mode-teleop" onclick="startTeleop()">
                    <div style="display:flex; align-items:center;">
                        <i class="fas fa-gamepad"></i>
                        <div>
                            <h3>TELEOP MODE</h3>
                            <span style="font-size:0.8rem; opacity:0.8;">Manual Control</span>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right mode-icon"></i>
                </div>

                <!-- Maintenance -->
                <div class="mode-card mode-maintenance" onclick="startMaintenance()">
                    <div style="display:flex; align-items:center;">
                        <i class="fas fa-tools"></i>
                        <div>
                            <h3>MAINTENANCE MODE</h3>
                            <span style="font-size:0.8rem; opacity:0.8;">Lifter & Diagnostics</span>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right mode-icon"></i>
                </div>

                <!-- Conveyor -->
                <div class="mode-card mode-conveyor" onclick="startConveyor()">
                    <div style="display:flex; align-items:center;">
                        <i class="fas fa-tape"></i>
                        <div>
                            <h3>CONVEYOR CONTROL</h3>
                            <span style="font-size:0.8rem; opacity:0.8;">Automated Testing</span>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right mode-icon"></i>
                </div>
            </div>

            <!-- BOTTOM SPLIT: COMMANDS & SPEED -->
            <div class="bottom-row">
                <!-- Command List -->
                <div class="panel">
                    <div class="panel-header">COMMANDS</div>
                    <div id="command-list-container" class="command-list-container">
                        <!-- Items injected by JS -->
                    </div>
                    <!-- Stop Button is critical so keep it here -->
                </div>

            </div>

        </div>

        <!-- RIGHT: TERMINAL -->
        <div class="terminal-panel">
            <div class="terminal-header-bar">
                <div class="term-title">
                    <i class="fas fa-terminal" style="color: #3b82f6;"></i> Live Terminal Output
                </div>
                <div class="term-controls">
                    <button onclick="clearTerminal()">Clear</button>
                    <button onclick="downloadTerminalLogs()" title="Download Logs"><i
                            class="fas fa-download"></i></button>
                </div>
            </div>
            <!-- Auto Scroll Toggle with Functionality -->
            <div onclick="toggleAutoScroll()"
                style="padding: 5px 15px; background: #1e293b; border-bottom: 1px solid #334155; display:flex; gap:10px; font-size:0.8rem; align-items:center; cursor: pointer; user-select: none;"
                title="Click to toggle auto-scroll">
                <i id="auto-scroll-icon" class="fas fa-toggle-on" style="color: #4ade80;"></i>
                <span id="auto-scroll-text">Auto-Scroll: ON</span>
            </div>
            <div id="terminal-output"></div>
        </div>
    </div>

    <!-- MODALS (Teleop/Maintenance hidden structures) -->
    <!-- Reuse existing modals logic but maybe style them later. Keeping simple for now -->

    <!-- TELEOP MODAL -->
    <div id="teleop-modal" class="modal hidden" style="display: none;">
        <div class="modal-content large" style="background: #1e293b; color: white;">
            <h3>Teleop - Robot <span id="teleop-robot-id"></span></h3>
            <div id="teleop-terminal" class="modal-terminal-container"></div>
            <button onclick="stopTeleop()" class="btn-red">Stop & Close</button>
        </div>
    </div>

    <!-- MAINTENANCE MODAL -->
    <div id="maintenance-modal" class="modal hidden" style="display: none;">
        <div class="modal-content large" style="background: #1e293b; color: white;">
            <h3>Maintenance - Robot <span id="maintenance-robot-id"></span></h3>
            <div id="maintenance-terminal" class="modal-terminal-container"></div>
            <button onclick="stopMaintenance()" class="btn-red">Stop & Close</button>
        </div>
    </div>

    <!-- CONVEYOR MODAL -->
    <div id="conveyor-modal" class="modal hidden" style="display: none;">
        <div class="modal-content large" style="height: auto; background: #1e293b; color: white;">
            <h3>Conveyor Control - Robot <span id="conveyor-robot-id"></span></h3>
            <div id="conveyor-terminal" class="terminal-output"
                style="width: 100%; height: 200px; background: #000; margin: 20px 0; text-align: left; overflow-y: scroll; padding: 10px; font-family: 'JetBrains Mono', monospace;">
            </div>
            <div class="conveyor-controls">
                <button class="conveyor-btn btn-green" onclick="runConveyor('forward')">Forward</button>
                <button class="conveyor-btn btn-blue" onclick="runConveyor('backward')">Backward</button>
                <button class="conveyor-btn btn-red" onclick="closeConveyorModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- SCREEN 3: ABOUT SCREEN (Hardware Info) -->
    <div id="about-screen" class="hidden">
        <div class="about-container">
            <div class="about-header">
                <button onclick="hideAbout()" class="back-link"><i class="fas fa-arrow-left"></i> Back to
                    Selection</button>
                <h1 id="about-robot-name">Robot Name</h1>
            </div>

            <div class="about-content">
                <div class="about-main-info">
                    <img id="about-robot-main-img" src="" alt="Robot Image">
                    <div class="about-text">
                        <h3>General Information</h3>
                        <p id="about-robot-desc">Description goes here.</p>
                        <div class="hardware-path-box">
                            <strong>Hardware Path:</strong> <code id="about-hardware-path">/dev/robot/...</code>
                        </div>
                    </div>
                </div>

                <div class="hardware-grid">
                    <div class="panel">
                        <div class="panel-header">Hardware Parts</div>
                        <div id="hardware-parts-container" class="hardware-list">
                            <!-- Items injected by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="xterm.js"></script>
    <script src="xterm-addon-fit.js"></script>
    <script src="script.js"></script>
</body>

</html>